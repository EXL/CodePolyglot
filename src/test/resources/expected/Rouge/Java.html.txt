<table class="code-table"><tr id="line-1"><td class="table-line l-table"><a href="#line-1">1</a></td><td class="code-line l-code"><span class="kn">package</span> <span class="nn">ru.exlmoto.code.controller</span><span class="o">;</span>
</td></tr><tr id="line-2"><td class="table-line d-table"><a href="#line-2">2</a></td><td class="code-line d-code">
</td></tr><tr id="line-3"><td class="table-line l-table"><a href="#line-3">3</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.core.JsonProcessingException</span><span class="o">;</span>
</td></tr><tr id="line-4"><td class="table-line d-table"><a href="#line-4">4</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span><span class="o">;</span>
</td></tr><tr id="line-5"><td class="table-line l-table"><a href="#line-5">5</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">com.fasterxml.jackson.databind.node.ObjectNode</span><span class="o">;</span>
</td></tr><tr id="line-6"><td class="table-line d-table"><a href="#line-6">6</a></td><td class="code-line d-code">
</td></tr><tr id="line-7"><td class="table-line l-table"><a href="#line-7">7</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="o">;</span>
</td></tr><tr id="line-8"><td class="table-line d-table"><a href="#line-8">8</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="o">;</span>
</td></tr><tr id="line-9"><td class="table-line l-table"><a href="#line-9">9</a></td><td class="code-line l-code">
</td></tr><tr id="line-10"><td class="table-line d-table"><a href="#line-10"><strong>10</strong></a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">org.springframework.util.StringUtils</span><span class="o">;</span>
</td></tr><tr id="line-11"><td class="table-line l-table"><a href="#line-11">11</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.GetMapping</span><span class="o">;</span>
</td></tr><tr id="line-12"><td class="table-line d-table"><a href="#line-12">12</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PathVariable</span><span class="o">;</span>
</td></tr><tr id="line-13"><td class="table-line l-table"><a href="#line-13">13</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.PostMapping</span><span class="o">;</span>
</td></tr><tr id="line-14"><td class="table-line d-table"><a href="#line-14">14</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RestController</span><span class="o">;</span>
</td></tr><tr id="line-15"><td class="table-line l-table"><a href="#line-15">15</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestParam</span><span class="o">;</span>
</td></tr><tr id="line-16"><td class="table-line d-table"><a href="#line-16">16</a></td><td class="code-line d-code">
</td></tr><tr id="line-17"><td class="table-line l-table"><a href="#line-17">17</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.configuration.CodeConfiguration</span><span class="o">;</span>
</td></tr><tr id="line-18"><td class="table-line d-table"><a href="#line-18">18</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.controller.enumeration.Skin</span><span class="o">;</span>
</td></tr><tr id="line-19"><td class="table-line l-table"><a href="#line-19">19</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.entity.CodeEntity</span><span class="o">;</span>
</td></tr><tr id="line-20"><td class="table-line d-table"><a href="#line-20"><strong>20</strong></a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.helper.ResourceHelper</span><span class="o">;</span>
</td></tr><tr id="line-21"><td class="table-line l-table"><a href="#line-21">21</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.helper.UtilityHelper</span><span class="o">;</span>
</td></tr><tr id="line-22"><td class="table-line d-table"><a href="#line-22">22</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.highlight.HighlightService</span><span class="o">;</span>
</td></tr><tr id="line-23"><td class="table-line l-table"><a href="#line-23">23</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.highlight.enumeration.Mode</span><span class="o">;</span>
</td></tr><tr id="line-24"><td class="table-line d-table"><a href="#line-24">24</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">ru.exlmoto.code.service.DatabaseService</span><span class="o">;</span>
</td></tr><tr id="line-25"><td class="table-line l-table"><a href="#line-25">25</a></td><td class="code-line l-code">
</td></tr><tr id="line-26"><td class="table-line d-table"><a href="#line-26">26</a></td><td class="code-line d-code"><span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
</td></tr><tr id="line-27"><td class="table-line l-table"><a href="#line-27">27</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">java.io.UncheckedIOException</span><span class="o">;</span>
</td></tr><tr id="line-28"><td class="table-line d-table"><a href="#line-28">28</a></td><td class="code-line d-code">
</td></tr><tr id="line-29"><td class="table-line l-table"><a href="#line-29">29</a></td><td class="code-line l-code"><span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>
</td></tr><tr id="line-30"><td class="table-line d-table"><a href="#line-30"><strong>30</strong></a></td><td class="code-line d-code">
</td></tr><tr id="line-31"><td class="table-line l-table"><a href="#line-31">31</a></td><td class="code-line l-code"><span class="nd">@RestController</span>
</td></tr><tr id="line-32"><td class="table-line d-table"><a href="#line-32">32</a></td><td class="code-line d-code"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApiController</span> <span class="o">{</span>
</td></tr><tr id="line-33"><td class="table-line l-table"><a href="#line-33">33</a></td><td class="code-line l-code">	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">ApiController</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</td></tr><tr id="line-34"><td class="table-line d-table"><a href="#line-34">34</a></td><td class="code-line d-code">
</td></tr><tr id="line-35"><td class="table-line l-table"><a href="#line-35">35</a></td><td class="code-line l-code">	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">CodeConfiguration</span> <span class="n">config</span><span class="o">;</span>
</td></tr><tr id="line-36"><td class="table-line d-table"><a href="#line-36">36</a></td><td class="code-line d-code">	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">DatabaseService</span> <span class="n">database</span><span class="o">;</span>
</td></tr><tr id="line-37"><td class="table-line l-table"><a href="#line-37">37</a></td><td class="code-line l-code">	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">HighlightService</span> <span class="n">highlight</span><span class="o">;</span>
</td></tr><tr id="line-38"><td class="table-line d-table"><a href="#line-38">38</a></td><td class="code-line d-code">	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">ResourceHelper</span> <span class="n">resource</span><span class="o">;</span>
</td></tr><tr id="line-39"><td class="table-line l-table"><a href="#line-39">39</a></td><td class="code-line l-code">	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">UtilityHelper</span> <span class="n">util</span><span class="o">;</span>
</td></tr><tr id="line-40"><td class="table-line d-table"><a href="#line-40"><strong>40</strong></a></td><td class="code-line d-code">
</td></tr><tr id="line-41"><td class="table-line l-table"><a href="#line-41">41</a></td><td class="code-line l-code">	<span class="kd">public</span> <span class="nf">ApiController</span><span class="o">(</span><span class="nc">CodeConfiguration</span> <span class="n">config</span><span class="o">,</span>
</td></tr><tr id="line-42"><td class="table-line d-table"><a href="#line-42">42</a></td><td class="code-line d-code">	                     <span class="nc">DatabaseService</span> <span class="n">database</span><span class="o">,</span>
</td></tr><tr id="line-43"><td class="table-line l-table"><a href="#line-43">43</a></td><td class="code-line l-code">	                     <span class="nc">HighlightService</span> <span class="n">highlight</span><span class="o">,</span>
</td></tr><tr id="line-44"><td class="table-line d-table"><a href="#line-44">44</a></td><td class="code-line d-code">	                     <span class="nc">ResourceHelper</span> <span class="n">resource</span><span class="o">,</span>
</td></tr><tr id="line-45"><td class="table-line l-table"><a href="#line-45">45</a></td><td class="code-line l-code">	                     <span class="nc">UtilityHelper</span> <span class="n">util</span><span class="o">)</span> <span class="o">{</span>
</td></tr><tr id="line-46"><td class="table-line d-table"><a href="#line-46">46</a></td><td class="code-line d-code">		<span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">;</span>
</td></tr><tr id="line-47"><td class="table-line l-table"><a href="#line-47">47</a></td><td class="code-line l-code">		<span class="k">this</span><span class="o">.</span><span class="na">database</span> <span class="o">=</span> <span class="n">database</span><span class="o">;</span>
</td></tr><tr id="line-48"><td class="table-line d-table"><a href="#line-48">48</a></td><td class="code-line d-code">		<span class="k">this</span><span class="o">.</span><span class="na">highlight</span> <span class="o">=</span> <span class="n">highlight</span><span class="o">;</span>
</td></tr><tr id="line-49"><td class="table-line l-table"><a href="#line-49">49</a></td><td class="code-line l-code">		<span class="k">this</span><span class="o">.</span><span class="na">resource</span> <span class="o">=</span> <span class="n">resource</span><span class="o">;</span>
</td></tr><tr id="line-50"><td class="table-line d-table"><a href="#line-50"><strong>50</strong></a></td><td class="code-line d-code">		<span class="k">this</span><span class="o">.</span><span class="na">util</span> <span class="o">=</span> <span class="n">util</span><span class="o">;</span>
</td></tr><tr id="line-51"><td class="table-line l-table"><a href="#line-51">51</a></td><td class="code-line l-code">	<span class="o">}</span>
</td></tr><tr id="line-52"><td class="table-line d-table"><a href="#line-52">52</a></td><td class="code-line d-code">
</td></tr><tr id="line-53"><td class="table-line l-table"><a href="#line-53">53</a></td><td class="code-line l-code">	<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/api/raw/{id}"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="s">"text/plain;charset=UTF-8"</span><span class="o">)</span>
</td></tr><tr id="line-54"><td class="table-line d-table"><a href="#line-54">54</a></td><td class="code-line d-code">	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">raw</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
</td></tr><tr id="line-55"><td class="table-line l-table"><a href="#line-55">55</a></td><td class="code-line l-code">		<span class="k">return</span> <span class="n">util</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="n">id</span><span class="o">).</span><span class="na">flatMap</span><span class="o">(</span><span class="nl">database:</span><span class="o">:</span><span class="n">getCodeSnippet</span><span class="o">).</span><span class="na">map</span><span class="o">(</span><span class="nl">CodeEntity:</span><span class="o">:</span><span class="n">getCodeRaw</span><span class="o">).</span><span class="na">orElse</span><span class="o">(</span>
</td></tr><tr id="line-56"><td class="table-line d-table"><a href="#line-56">56</a></td><td class="code-line d-code">			<span class="s">"Error: Cannot get code snippet with '"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"' id."</span>
</td></tr><tr id="line-57"><td class="table-line l-table"><a href="#line-57">57</a></td><td class="code-line l-code">		<span class="o">);</span>
</td></tr><tr id="line-58"><td class="table-line d-table"><a href="#line-58">58</a></td><td class="code-line d-code">	<span class="o">}</span>
</td></tr><tr id="line-59"><td class="table-line l-table"><a href="#line-59">59</a></td><td class="code-line l-code">
</td></tr><tr id="line-60"><td class="table-line d-table"><a href="#line-60"><strong>60</strong></a></td><td class="code-line d-code">	<span class="cm">/*</span>
</td></tr><tr id="line-61"><td class="table-line l-table"><a href="#line-61">61</a></td><td class="code-line l-code"><span class="cm">	 * Highlight API usage examples:</span>
</td></tr><tr id="line-62"><td class="table-line d-table"><a href="#line-62">62</a></td><td class="code-line d-code"><span class="cm">	 *  $ cat file.txt | curl --data-binary @- "https://code.exlmoto.ru/api/"</span>
</td></tr><tr id="line-63"><td class="table-line l-table"><a href="#line-63">63</a></td><td class="code-line l-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml"</span>
</td></tr><tr id="line-64"><td class="table-line d-table"><a href="#line-64">64</a></td><td class="code-line d-code"><span class="cm">	 *  $ cat src.java | curl --data-binary @- "https://code.exlmoto.ru/api/?o=java"</span>
</td></tr><tr id="line-65"><td class="table-line l-table"><a href="#line-65">65</a></td><td class="code-line l-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines"</span>
</td></tr><tr id="line-66"><td class="table-line d-table"><a href="#line-66">66</a></td><td class="code-line d-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines;15"</span>
</td></tr><tr id="line-67"><td class="table-line l-table"><a href="#line-67">67</a></td><td class="code-line l-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines;15,20"</span>
</td></tr><tr id="line-68"><td class="table-line d-table"><a href="#line-68">68</a></td><td class="code-line d-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines;15,20&amp;h=HighlightJs"</span>
</td></tr><tr id="line-69"><td class="table-line l-table"><a href="#line-69">69</a></td><td class="code-line l-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines;15,20&amp;h=HighlightRouge"</span>
</td></tr><tr id="line-70"><td class="table-line d-table"><a href="#line-70"><strong>70</strong></a></td><td class="code-line d-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines;15,20&amp;h=HighlightPygments"</span>
</td></tr><tr id="line-71"><td class="table-line l-table"><a href="#line-71">71</a></td><td class="code-line l-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml;nolines;15&amp;h=HighlightPygmentsJython"</span>
</td></tr><tr id="line-72"><td class="table-line d-table"><a href="#line-72">72</a></td><td class="code-line d-code"><span class="cm">	 *</span>
</td></tr><tr id="line-73"><td class="table-line l-table"><a href="#line-73">73</a></td><td class="code-line l-code"><span class="cm">	 * Create simple HTML page:</span>
</td></tr><tr id="line-74"><td class="table-line d-table"><a href="#line-74">74</a></td><td class="code-line d-code"><span class="cm">	 *  $ cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml" &gt; page.html</span>
</td></tr><tr id="line-75"><td class="table-line l-table"><a href="#line-75">75</a></td><td class="code-line l-code"><span class="cm">	 * Another way:</span>
</td></tr><tr id="line-76"><td class="table-line d-table"><a href="#line-76">76</a></td><td class="code-line d-code"><span class="cm">	 *  $ CONTENT=`cat file.xml | curl --data-binary @- "https://code.exlmoto.ru/api/?o=xml"`</span>
</td></tr><tr id="line-77"><td class="table-line l-table"><a href="#line-77">77</a></td><td class="code-line l-code"><span class="cm">	 *  $ echo "&lt;code class="hljs highlight"&gt;&lt;pre&gt;$CONTENT&lt;/pre&gt;&lt;/code&gt;" &gt; page.html</span>
</td></tr><tr id="line-78"><td class="table-line d-table"><a href="#line-78">78</a></td><td class="code-line d-code"><span class="cm">	 */</span>
</td></tr><tr id="line-79"><td class="table-line l-table"><a href="#line-79">79</a></td><td class="code-line l-code">	<span class="nd">@PostMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/api"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="s">"text/plain;charset=UTF-8"</span><span class="o">)</span>
</td></tr><tr id="line-80"><td class="table-line d-table"><a href="#line-80"><strong>80</strong></a></td><td class="code-line d-code">	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">highlight</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">inputDataStream</span><span class="o">,</span>
</td></tr><tr id="line-81"><td class="table-line l-table"><a href="#line-81">81</a></td><td class="code-line l-code">	                        <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"o"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">""</span><span class="o">)</span> <span class="nc">String</span> <span class="n">options</span><span class="o">,</span>
</td></tr><tr id="line-82"><td class="table-line d-table"><a href="#line-82">82</a></td><td class="code-line d-code">	                        <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"h"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"HighlightJs"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span>
</td></tr><tr id="line-83"><td class="table-line l-table"><a href="#line-83">83</a></td><td class="code-line l-code">		<span class="nc">Scanner</span> <span class="n">scanner</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Scanner</span><span class="o">(</span><span class="n">inputDataStream</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">"\\A"</span><span class="o">);</span> <span class="c1">// https://stackoverflow.com/a/5445161</span>
</td></tr><tr id="line-84"><td class="table-line d-table"><a href="#line-84">84</a></td><td class="code-line d-code">		<span class="k">if</span> <span class="o">(</span><span class="n">scanner</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
</td></tr><tr id="line-85"><td class="table-line l-table"><a href="#line-85">85</a></td><td class="code-line l-code">			<span class="nc">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">scanner</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
</td></tr><tr id="line-86"><td class="table-line d-table"><a href="#line-86">86</a></td><td class="code-line d-code">			<span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">hasText</span><span class="o">(</span><span class="n">code</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">code</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="o">.</span><span class="na">getSnippetMaxLength</span><span class="o">())</span> <span class="o">{</span>
</td></tr><tr id="line-87"><td class="table-line l-table"><a href="#line-87">87</a></td><td class="code-line l-code">				<span class="k">return</span> <span class="n">highlight</span><span class="o">.</span><span class="na">highlightCode</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">getMode</span><span class="o">(</span><span class="n">mode</span><span class="o">),</span> <span class="n">util</span><span class="o">.</span><span class="na">getCorrectOptions</span><span class="o">(</span><span class="n">options</span><span class="o">),</span> <span class="n">code</span><span class="o">);</span>
</td></tr><tr id="line-88"><td class="table-line d-table"><a href="#line-88">88</a></td><td class="code-line d-code">			<span class="o">}</span>
</td></tr><tr id="line-89"><td class="table-line l-table"><a href="#line-89">89</a></td><td class="code-line l-code">		<span class="o">}</span>
</td></tr><tr id="line-90"><td class="table-line d-table"><a href="#line-90"><strong>90</strong></a></td><td class="code-line d-code">		<span class="n">scanner</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</td></tr><tr id="line-91"><td class="table-line l-table"><a href="#line-91">91</a></td><td class="code-line l-code">		<span class="k">return</span> <span class="s">"Error: Cannot highlight code snippet."</span><span class="o">;</span>
</td></tr><tr id="line-92"><td class="table-line d-table"><a href="#line-92">92</a></td><td class="code-line d-code">	<span class="o">}</span>
</td></tr><tr id="line-93"><td class="table-line l-table"><a href="#line-93">93</a></td><td class="code-line l-code">
</td></tr><tr id="line-94"><td class="table-line d-table"><a href="#line-94">94</a></td><td class="code-line d-code">	<span class="cm">/*</span>
</td></tr><tr id="line-95"><td class="table-line l-table"><a href="#line-95">95</a></td><td class="code-line l-code"><span class="cm">	 * Highlight CSS usage examples:</span>
</td></tr><tr id="line-96"><td class="table-line d-table"><a href="#line-96">96</a></td><td class="code-line d-code"><span class="cm">	 * $ curl "https://code.exlmoto.ru/api/css"</span>
</td></tr><tr id="line-97"><td class="table-line l-table"><a href="#line-97">97</a></td><td class="code-line l-code"><span class="cm">	 * $ curl "https://code.exlmoto.ru/api/css?skin=pastorg"</span>
</td></tr><tr id="line-98"><td class="table-line d-table"><a href="#line-98">98</a></td><td class="code-line d-code"><span class="cm">	 * $ curl "https://code.exlmoto.ru/api/css?skin=pastorg&amp;mode=HighlightRouge"</span>
</td></tr><tr id="line-99"><td class="table-line l-table"><a href="#line-99">99</a></td><td class="code-line l-code"><span class="cm">	 * $ curl "https://code.exlmoto.ru/api/css?skin=techno&amp;mode=HighlightPygments"</span>
</td></tr><tr id="line-100"><td class="table-line d-table"><a href="#line-100"><strong>100</strong></a></td><td class="code-line d-code"><span class="cm">	 */</span>
</td></tr><tr id="line-101"><td class="table-line l-table"><a href="#line-101">101</a></td><td class="code-line l-code">	<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/api/css"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="s">"text/css;charset=UTF-8"</span><span class="o">)</span>
</td></tr><tr id="line-102"><td class="table-line d-table"><a href="#line-102">102</a></td><td class="code-line d-code">	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">css</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"skin"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"techno"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">skin</span><span class="o">,</span>
</td></tr><tr id="line-103"><td class="table-line l-table"><a href="#line-103">103</a></td><td class="code-line l-code">	                  <span class="nd">@RequestParam</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"mode"</span><span class="o">,</span> <span class="n">required</span> <span class="o">=</span> <span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span> <span class="o">=</span> <span class="s">"HighlightJs"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">mode</span><span class="o">)</span> <span class="o">{</span>
</td></tr><tr id="line-104"><td class="table-line d-table"><a href="#line-104">104</a></td><td class="code-line d-code">		<span class="k">try</span> <span class="o">{</span>
</td></tr><tr id="line-105"><td class="table-line l-table"><a href="#line-105">105</a></td><td class="code-line l-code">			<span class="k">return</span> <span class="n">resource</span><span class="o">.</span><span class="na">readFileToString</span><span class="o">(</span><span class="s">"classpath:"</span> <span class="o">+</span> <span class="nc">Mode</span><span class="o">.</span><span class="na">getCss</span><span class="o">(</span><span class="nc">Mode</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">mode</span><span class="o">),</span> <span class="nc">Skin</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">skin</span><span class="o">)));</span>
</td></tr><tr id="line-106"><td class="table-line d-table"><a href="#line-106">106</a></td><td class="code-line d-code">		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IllegalArgumentException</span> <span class="o">|</span> <span class="nc">UncheckedIOException</span> <span class="n">ignored</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
</td></tr><tr id="line-107"><td class="table-line l-table"><a href="#line-107">107</a></td><td class="code-line l-code">		<span class="k">return</span> <span class="s">"Error: Cannot get CSS from resources."</span><span class="o">;</span>
</td></tr><tr id="line-108"><td class="table-line d-table"><a href="#line-108">108</a></td><td class="code-line d-code">	<span class="o">}</span>
</td></tr><tr id="line-109"><td class="table-line l-table"><a href="#line-109">109</a></td><td class="code-line l-code">
</td></tr><tr id="line-110"><td class="table-line d-table"><a href="#line-110"><strong>110</strong></a></td><td class="code-line d-code">	<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">path</span> <span class="o">=</span> <span class="s">"/api/versions"</span><span class="o">,</span> <span class="n">produces</span> <span class="o">=</span> <span class="s">"application/json;charset=UTF-8"</span><span class="o">)</span>
</td></tr><tr id="line-111"><td class="table-line l-table"><a href="#line-111">111</a></td><td class="code-line l-code">	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">versions</span><span class="o">()</span> <span class="o">{</span>
</td></tr><tr id="line-112"><td class="table-line d-table"><a href="#line-112">112</a></td><td class="code-line d-code">		<span class="kd">final</span> <span class="nc">ObjectMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>
</td></tr><tr id="line-113"><td class="table-line l-table"><a href="#line-113">113</a></td><td class="code-line l-code">		<span class="kd">final</span> <span class="nc">ObjectNode</span> <span class="n">root</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">createObjectNode</span><span class="o">();</span>
</td></tr><tr id="line-114"><td class="table-line d-table"><a href="#line-114">114</a></td><td class="code-line d-code">		<span class="n">highlight</span><span class="o">.</span><span class="na">getVersions</span><span class="o">().</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
</td></tr><tr id="line-115"><td class="table-line l-table"><a href="#line-115">115</a></td><td class="code-line l-code">			<span class="kd">final</span> <span class="nc">ObjectNode</span> <span class="n">child</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">createObjectNode</span><span class="o">();</span>
</td></tr><tr id="line-116"><td class="table-line d-table"><a href="#line-116">116</a></td><td class="code-line d-code">			<span class="n">child</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"language"</span><span class="o">,</span> <span class="n">v</span><span class="o">.</span><span class="na">getFirst</span><span class="o">());</span>
</td></tr><tr id="line-117"><td class="table-line l-table"><a href="#line-117">117</a></td><td class="code-line l-code">			<span class="n">child</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"library"</span><span class="o">,</span> <span class="n">v</span><span class="o">.</span><span class="na">getSecond</span><span class="o">());</span>
</td></tr><tr id="line-118"><td class="table-line d-table"><a href="#line-118">118</a></td><td class="code-line d-code">			<span class="n">root</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">k</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="n">child</span><span class="o">);</span>
</td></tr><tr id="line-119"><td class="table-line l-table"><a href="#line-119">119</a></td><td class="code-line l-code">		<span class="o">});</span>
</td></tr><tr id="line-120"><td class="table-line d-table"><a href="#line-120"><strong>120</strong></a></td><td class="code-line d-code">		<span class="n">root</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"GraalVM"</span><span class="o">,</span> <span class="n">highlight</span><span class="o">.</span><span class="na">getGraalVMVersion</span><span class="o">());</span>
</td></tr><tr id="line-121"><td class="table-line l-table"><a href="#line-121">121</a></td><td class="code-line l-code">
</td></tr><tr id="line-122"><td class="table-line d-table"><a href="#line-122">122</a></td><td class="code-line d-code">		<span class="k">try</span> <span class="o">{</span>
</td></tr><tr id="line-123"><td class="table-line l-table"><a href="#line-123">123</a></td><td class="code-line l-code">			<span class="k">return</span> <span class="n">mapper</span><span class="o">.</span><span class="na">writerWithDefaultPrettyPrinter</span><span class="o">().</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">root</span><span class="o">);</span>
</td></tr><tr id="line-124"><td class="table-line d-table"><a href="#line-124">124</a></td><td class="code-line d-code">		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">JsonProcessingException</span> <span class="n">jpe</span><span class="o">)</span> <span class="o">{</span>
</td></tr><tr id="line-125"><td class="table-line l-table"><a href="#line-125">125</a></td><td class="code-line l-code">			<span class="kd">final</span> <span class="nc">String</span> <span class="n">error</span> <span class="o">=</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Cannot generate JSON version information: '%s'."</span><span class="o">,</span> <span class="n">jpe</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</td></tr><tr id="line-126"><td class="table-line d-table"><a href="#line-126">126</a></td><td class="code-line d-code">			<span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">error</span><span class="o">,</span> <span class="n">jpe</span><span class="o">);</span>
</td></tr><tr id="line-127"><td class="table-line l-table"><a href="#line-127">127</a></td><td class="code-line l-code">			<span class="k">return</span> <span class="s">"{ \"error\" : \""</span> <span class="o">+</span> <span class="n">error</span> <span class="o">+</span> <span class="s">"\" }"</span><span class="o">;</span>
</td></tr><tr id="line-128"><td class="table-line d-table"><a href="#line-128">128</a></td><td class="code-line d-code">		<span class="o">}</span>
</td></tr><tr id="line-129"><td class="table-line l-table"><a href="#line-129">129</a></td><td class="code-line l-code">	<span class="o">}</span>
</td></tr><tr id="line-130"><td class="table-line d-table"><a href="#line-130"><strong>130</strong></a></td><td class="code-line d-code"><span class="o">}</span>
</td></tr></table>